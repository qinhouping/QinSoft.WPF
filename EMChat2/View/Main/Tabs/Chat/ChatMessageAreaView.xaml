<UserControl x:Class="EMChat2.View.Main.Tabs.Chat.ChatMessageAreaView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
             xmlns:view="clr-namespace:EMChat2.View"
             xmlns:chat="clr-namespace:EMChat2.View.Main.Tabs.Chat"
             xmlns:wpf="clr-namespace:QinSoft.WPF;assembly=QinSoft.WPF"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>
        <wpf:BindingProxy x:Key="chatData" Data="{Binding}"></wpf:BindingProxy>
        <Style TargetType="{x:Type RichTextBox}" BasedOn="{StaticResource IM-RichTextBox}">
            <Setter Property="MaxWidth" Value="200"></Setter>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.Resources>
            <ContextMenu x:Key="MessageContextMenu">
                <MenuItem Header="拷贝" Command="{Binding Data.CopyMessageCommand,Source={StaticResource chatData}}" CommandParameter="{Binding}"></MenuItem>
            </ContextMenu>

            <!--消息用户-->
            <Style x:Key="IM-MessageUser" TargetType="{x:Type Label}">
                <Setter Property="FontFamily" Value="{StaticResource DefaultFontFamily}"></Setter>
                <Setter Property="FontSize" Value="{StaticResource DefaultFontSize}"></Setter>
            </Style>

            <!--消息内容-->
            <Style x:Key="IM-MessageContent" TargetType="{x:Type Label}">
                <Setter Property="Foreground" Value="Black"></Setter>
                <Setter Property="Background" Value="#EEEEEE"></Setter>
                <Setter Property="BorderBrush" Value="#DDDDDD"></Setter>
                <Setter Property="BorderThickness" Value="1"></Setter>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type Label}">
                            <Border x:Name="PART_Border" CornerRadius="2" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}">
                                <ContentPresenter x:Name="PART_Content" Margin="{TemplateBinding Padding}" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" TextBlock.Foreground="{TemplateBinding Foreground}" TextBlock.FontSize="{TemplateBinding FontSize}" TextBlock.FontFamily="{TemplateBinding FontFamily}" TextBlock.FontStyle="{TemplateBinding FontStyle}" TextBlock.FontStretch="{TemplateBinding FontStretch}" ContentStringFormat="{TemplateBinding ContentStringFormat}" ContentTemplate="{TemplateBinding ContentTemplate}"></ContentPresenter>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <!--消息状态-->
            <Style x:Key="IM-MessageState" TargetType="{x:Type Label}" BasedOn="{StaticResource Chip}">
                <Setter Property="FontSize" Value="10"></Setter>
                <Setter Property="Margin" Value="2"></Setter>
                <Setter Property="Foreground" Value="#999999"></Setter>
            </Style>

            <!--消息模板-->
            <DataTemplate x:Key="IM-Message">
                <Grid HorizontalAlignment="Left" Margin="5" MaxWidth="{Binding ActualWidth,RelativeSource={RelativeSource AncestorType=ListBoxItem, Mode=FindAncestor},Converter={x:Static wpf:ValueConverters.AvgConverter},ConverterParameter=2}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"></RowDefinition>
                        <RowDefinition Height="*"></RowDefinition>
                        <RowDefinition Height="Auto"></RowDefinition>
                    </Grid.RowDefinitions>
                    <Label Grid.Row="0" HorizontalAlignment="Left" Style="{StaticResource IM-MessageUser}" Content="{Binding FromUser}"></Label>
                    <Label Grid.Row="1" HorizontalAlignment="Left" Style="{StaticResource IM-MessageContent}" Content="{Binding Content,Converter={x:Static view:ValueConverters.MessageToDisplayerConverter}}"></Label>
                    <Label Grid.Row="2" HorizontalAlignment="Left" Style="{StaticResource IM-MessageState}" Content="{Binding State,Converter={x:Static wpf:ValueConverters.EnumToDescriptionConverter}}"></Label>
                </Grid>
            </DataTemplate>
        </Grid.Resources>


        <Border BorderThickness="0,1,0,1" BorderBrush="#CCCCCC">
            <Grid>
                <ListBox Style="{StaticResource IM-Messsage-List}" ItemContainerStyle="{StaticResource IM-Messsage-ListItem}" ItemTemplate="{StaticResource IM-Message}" ItemsSource="{Binding Messages}" ></ListBox>
                <Button x:Name="hasNewMessageButton" Style="{StaticResource FlatButton-Success}" Opacity="0.6" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Bottom" Height="30">
                    <StackPanel  Orientation="Horizontal">
                        <TextBlock Style="{StaticResource IconArrowDown}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="2"></TextBlock>
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Margin="2,2,0,2" Text="{Binding NotReadMessageCount}"></TextBlock>
                        <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,2,2,2" Text="条新消息"></TextBlock>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>
    </Grid>
</UserControl>
